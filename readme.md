# 代码概览（中英双语）  
# Project Code Overview (Chinese & English)

本目录提供有限元/扩散模拟相关的 MATLAB 与 Python（Jupyter）脚本。以下按照典型流程介绍各文件的主要作用、调用顺序、输入与输出。  
This folder hosts MATLAB and Python (Jupyter) scripts for finite-element–style diffusion simulations. The sections below outline each file’s purpose, usual invocation order, inputs, and outputs.

---

## 一、核心计算与可视化 / Core Simulation & Visualization

### `core_0.m`
- **作用 / Purpose**：在给定的网格尺寸、扩散系数和边界条件下执行一次二维扩散迭代，返回场值以及指定阈值的等值线图形句柄。  
- **调用 / Call**：`[fig, C, z, x, y] = core_0(Lx, Ly, afr, inum, iflag, threshold)`（所有参数可省略，默认 `20, 20, 0.5, 20, 1, 0.8`）。  
- **输入参数 / Inputs**：  
  - `Lx, Ly`：物理尺寸（与单元数一致） / domain size (matches cell count).  
  - `afr`：扩散系数放大因子 / amplification factor.  
  - `inum`：时间步数 / iteration steps.  
  - `iflag`：边界条件模式（1~6）/ boundary pattern selector.  
  - `threshold`：绘制等值线阈值 / contour threshold.  
- **输出 / Outputs**：  
  - `fig`：图形句柄（未显示）/ figure handle (off-screen).  
  - `C`：对应阈值的 contour 矩阵 / contour matrix at `threshold`.  
  - `z`：`n×m` 场值矩阵 / field matrix.  
  - `x, y`：网格坐标向量 / coordinate grids.  
- **典型位置 / Typical role**：被后续数据收集或绘图脚本调用以获取单次场解。  
  Used by downstream collection/plot scripts to obtain single-step solutions.

### `draw_picture_2.m`
- **作用**：封装一次模拟并绘制/保存二维截面图像。  
- **调用**：直接在 MATLAB 中运行，内部多处调用 `core_0`。  
- **输出**：生成图像文件或显示窗口（视脚本内部设置而定）。  
- **Purpose**: Runs a simulation and renders/saves 2D snapshots, often via `core_0`.  
- **Output**: Figures on screen or exported files, depending on script settings.

### `draw_3d_4.m`
- **作用**：基于 `core_0` 输出的场数据绘制三维曲面或三维等值图。  
- **调用**：手动运行，内部会再次求解或加载已有 `core_0` 结果。  
- **输出**：三维图形（图窗或文件）。  
- **Purpose**: Produces 3D surface/isosurface plots from `core_0` results.  
- **Output**: 3D figures shown or saved.

---

## 二、时间特征分析 / Feature-Time Analysis

### `feature_time_1.m`
- **作用**：批量遍历参数组合，统计“全部单元达到阈值”所需的最小时间步（特征时间）。  
- **调用**：`feature_time_1`，内部使用 `compute_feature_time_one` 循环推进。  
- **输入**：脚本内置一组 `PARAMS`（可按需修改），包含 `Lx/Ly/afr/iflag`。阈值固定为 0.8。  
- **输出**：命令行打印每组参数的特征时间或未填满提示；不写文件。  
- **Purpose**: Bulk-scan parameter sets to find earliest full fill time at threshold 0.8.  
- **Output**: Console logs only; no files.

### `feature_time_analysis_1.ipynb`
- **作用**：在 Jupyter 中对 `feature_time_1` 或外部生成的数据进行统计、作图。  
- **输入**：Notebook 单元内部读取 MATLAB 输出或预存的 CSV/Mat 文件。  
- **输出**：Notebook 内部图表、表格、统计结果，可导出图像或 HTML。  
- **Purpose**: Interactive analysis notebook for feature-time statistics.  
- **Outputs**: Inline charts/tables; optional exports by the user.

---

## 三、界面数据采集与分析 / Interface Data Collection

### `collect_interface_data_3.m`
- **作用**：在扩散过程中定期提取右上象限的等值线点，并计算曲率。  
- **调用**：`collect_interface_data_3(Lx, Ly, afr, total_steps, step_interval)`，默认 `60,60,0.25,3000,60`，`iflag=1`。  
- **过程**：内部按固定步长调用扩散迭代（逻辑类似 `core_0`），对每个收集时间步进行插值和等值线抽取。  
- **输出**：  
  - `interface_points{t}`、`curvatures{t}`：在 MATLAB 工作空间返回的 cell 数组。  
  - 命令行打印进度；如需持久化，可自行在外层保存结果。  
- **Purpose**: Sample interface points and curvature during diffusion at regular intervals.  
- **Outputs**: Cell arrays returned to MATLAB workspace; console logs for progress.

### `data_collect_3.m`
- **作用**：配合 `collect_interface_data_3`，针对一系列参数循环收集界面数据并写出 CSV。  
- **调用**：脚本开头配置参数及输出目录，运行时会批量调用 `collect_interface_data_3`。  
- **输出**：在指定目录下生成 `timestep_xxxx.csv` 等文件，记录插值后的界面点坐标和曲率。  
- **Purpose**: Batch runner that repeatedly invokes `collect_interface_data_3` for multiple cases, writing CSV outputs.  
- **Outputs**: `timestep_*.csv` files in configured folders (columns typically include point coordinates/curvature).

### `data_collect_3.ipynb`
- **作用**：读取 `data_collect_3.m` 输出的 CSV（含 index/parameters 文件），进行可视化或进一步计算。  
- **输入**：Notebook 内需指定 `data_dir`，其中包含 `parameters.csv`、`index.csv` 及各时间步 CSV。  
- **输出**：Jupyter 渲染的图表、统计和导出结果（需手动保存）。  
- **Purpose**: Post-processing notebook for the CSV dataset generated by `data_collect_3.m`.  
- **Outputs**: Inline plots/stats; export handled by the user.

---

## 四、敏感性分析 / Sensitivity Study

### `sensitive_analysis_4.m`
- **作用**：在 `iflag=1` 情况下遍历参数组合（`Lx/Ly ∈ {40,60,80}`, `afr ∈ {0.1,0.25,0.4}`, `threshold ∈ {0.65,0.8,0.95}`），统计 50% 铺满与完全铺满步长，并提取关键时刻的等值线。  
- **调用**：`sensitive_analysis_4`（需将当前目录设为本项目根目录）。  
- **过程 / Flow**：  
  1. 逐组运行内部迭代（逻辑等同 `iflag=1` 的差分更新）。  
  2. 记录首次达到 50% 铺满的时间步 `t50`，以及 `t50 ± 20`（若存在）。  
  3. 记录首次全部单元 ≥ 阈值的时间步 `t_full`（若未达到则为 NA）。  
  4. 对 `t50-20`, `t50`, `t50+20` 的场数据提取阈值等值线并保存。  
- **输出 / Outputs**：  
  - 控制台打印：每组参数的 `t50` 和 `t_full`。  
  - 文件夹：若不存在，自动创建 `sensitive_analysis/`。  
  - CSV：命名 `Lx{Lx}_Ly{Ly}_afr{afr}_flag1_timestep{step}.csv`，包含两列 `x`,`y`，存储对应时间步的等值线点。无等值线时不生成文件。  
  - 最大时间步上限 `max_steps = 60000`（可按需调整）。  
- **Purpose (English)**: Enumerates parameter combinations under `iflag=1`, tracks half-fill (`t50`) and full-fill times, and exports contour coordinates at `t50 ± 20` and `t50`.  
- **Outputs (English)**: Console summary plus CSV files in `sensitive_analysis/` with columns `x`,`y`.

---

## 五、目录与辅助数据 / Directories & Auxiliary Data

- `sensitive_analysis/`：由 `sensitive_analysis_4.m` 生成的等值线 CSV。  
  CSV columns: `x`, `y`.
- `interface_data_Lx60_Ly60_afr0.25_csv/` 等：`data_collect_3.m` 输出的数据集合，每个子目录含参数说明与时间步 CSV。  
  Contains parameter metadata (`parameters.csv`, `index.csv`) plus per-step contour/curvature files.
- `L40x40_afr0p250_flag*/`, `L60x60_afr0p250_flag*/`, `L80x80_afr0p250_flag*/`：根据不同 `iflag` 分类存放的模拟结果或中间数据。具体结构请参考各目录内文件名。  
  These folders organize simulation snapshots by size and `iflag`. Files inside follow naming conventions reflecting time steps or processing stage.

---

## 六、推荐使用顺序 / Suggested Usage Order

1. **单次场解 / Single run**：使用 `core_0.m`（或 `draw_picture_2.m` / `draw_3d_4.m`）快速查看场分布。  
   Use these for quick inspection of diffusion patterns.
2. **特征时间评估 / Feature-time scan**：运行 `feature_time_1.m`，可在 Notebook `feature_time_analysis_1.ipynb` 中整理结果。  
   Run `feature_time_1`, then analyze with the notebook.
3. **界面抽取 / Interface extraction**：按需调用 `collect_interface_data_3.m`，利用 `data_collect_3.m` 批量生成 CSV，并在 `data_collect_3.ipynb` 中后处理。  
   Combine MATLAB scripts with the notebook for data post-processing.
4. **敏感性分析 / Sensitivity study**：执行 `sensitive_analysis_4.m`，比较不同尺寸/阈值/`afr` 的铺满速度并获取等值线数据。  
   Provides comparative metrics and contour snapshots across parameter sets.

> 以上脚本相互独立，可根据研究需求单独或串联使用；Jupyter Notebook 主要承担可视化与统计整理。  
> Scripts are loosely coupled—invoke individually or in sequence per study needs; notebooks focus on visualization and statistics.

