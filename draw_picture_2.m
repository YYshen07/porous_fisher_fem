function draw_picture_2()
% 统一按参数目录保存 PNG（不再保存 CSV）
% 目录：L{Lx}x{Ly}_afr{0p***}_flag{iflag}
% 文件：t{inum}.png

% —— 批量任务配置（按需修改）
PARAMS = [ ...
    % struct('Lx',40,'Ly',40,'afr',0.25,'iflag',1,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',40,'Ly',40,'afr',0.25,'iflag',2,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',40,'Ly',40,'afr',0.25,'iflag',3,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',40,'Ly',40,'afr',0.25,'iflag',4,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',40,'Ly',40,'afr',0.25,'iflag',5,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',40,'Ly',40,'afr',0.25,'iflag',6,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.25,'iflag',1,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.25,'iflag',2,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.25,'iflag',3,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.25,'iflag',4,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.25,'iflag',5,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.25,'iflag',6,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',80,'Ly',80,'afr',0.25,'iflag',1,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',80,'Ly',80,'afr',0.25,'iflag',2,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',80,'Ly',80,'afr',0.25,'iflag',3,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',80,'Ly',80,'afr',0.25,'iflag',4,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',80,'Ly',80,'afr',0.25,'iflag',5,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',80,'Ly',80,'afr',0.25,'iflag',6,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.126,'iflag',1,'time_points',[200 400 800 1600 3200 6400]), ...
    % struct('Lx',60,'Ly',60,'afr',0.04,'iflag',1,'time_points',[200 400 800 1600 3200 6400]), ...
    % afr = 0.250 的组合 (重合点: 500, 1000, 2000)
struct('Lx',40,'Ly',40,'afr',0.250,'iflag',1,'time_points',[500, 1000, 1200, 1289, 2000]), ...
struct('Lx',60,'Ly',60,'afr',0.250,'iflag',1,'time_points',[500, 1000, 2000, 2900, 2951, 4000]), ...
struct('Lx',80,'Ly',80,'afr',0.250,'iflag',1,'time_points',[500, 1000, 2000, 4000, 5200, 5292, 6000]), ...

% afr = 0.126 的组合 (重合点: 1000, 2000, 4000) 
struct('Lx',40,'Ly',40,'afr',0.126,'iflag',1,'time_points',[1000, 2000, 2500, 2558, 4000]), ...
struct('Lx',60,'Ly',60,'afr',0.126,'iflag',1,'time_points',[1000, 2000, 4000, 5800, 5856, 8000]), ...
struct('Lx',80,'Ly',80,'afr',0.126,'iflag',1,'time_points',[1000, 2000, 4000, 8000, 10400, 10500, 12000]), ...

% afr = 0.040 的组合 (重合点: 5000, 10000)
struct('Lx',40,'Ly',40,'afr',0.040,'iflag',1,'time_points',[2000, 5000, 8000, 8056, 10000]), ...
struct('Lx',60,'Ly',60,'afr',0.040,'iflag',1,'time_points',[5000, 10000, 15000, 18400, 18444, 25000]), ...
struct('Lx',80,'Ly',80,'afr',0.040,'iflag',1,'time_points',[5000, 10000, 15000, 25000, 33000, 33073, 35000])


];

for k = 1:numel(PARAMS)
    p = PARAMS(k);
    outdir = param_dirname(p.Lx, p.Ly, p.afr, p.iflag);
    if ~exist(outdir, 'dir'); mkdir(outdir); end

    tlist = unique(p.time_points(:).');  % 行向量
    fprintf('开始：%s；时间点：%s\n', outdir, num2str(tlist));

    for inum = tlist
        % —— 计算并出图（不保存）
        [fig, ~] = core_0(p.Lx, p.Ly, p.afr, inum, p.iflag);

        % —— 保存 PNG（仅新接口）
        pngfile = fullfile(outdir, sprintf('t%d.png', inum));
        exportgraphics(fig, pngfile, 'Resolution', 300);

        % —— 收尾
        close(fig);
        fprintf('已保存：%s\n', pngfile);
    end
end
end

% —— 参数目录名（afr 的小数点替换为 p，例：0.25 -> 0p250）
function outdir = param_dirname(Lx, Ly, afr, iflag)
afr_str = strrep(num2str(afr, '%.3f'), '.', 'p');
outdir  = sprintf('L%dx%d_afr%s_flag%d', Lx, Ly, afr_str, iflag);
end